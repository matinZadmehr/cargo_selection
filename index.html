<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­Ù…ÙˆÙ„Ù‡ | Carry to Me</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            direction: rtl;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 550px;
            overflow: hidden;
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: 700;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .section {
            margin: 25px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: #f9f9f9;
        }
        
        .section-title {
            color: #444;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .section-title i {
            color: #3498db;
        }
        
        /* Cargo Type Selection - Cards Layout */
        .cargo-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 480px) {
            .cargo-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .cargo-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .cargo-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .cargo-card.selected {
            border-color: #2ecc71;
            background-color: #f0f9f0;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.2);
        }
        
        .cargo-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 10px;
        }
        
        /* Different colors for different cargo types */
        .cargo-1 .cargo-icon { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }
        .cargo-2 .cargo-icon { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
        .cargo-3 .cargo-icon { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); }
        .cargo-4 .cargo-icon { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
        .cargo-5 .cargo-icon { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); }
        .cargo-6 .cargo-icon { background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%); }
        
        .cargo-name {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .cargo-desc {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        /* Weight Slider Section */
        .weight-display {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border: 2px solid #dee2e6;
        }
        
        .weight-value {
            font-size: 48px;
            font-weight: 800;
            color: #2c3e50;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }
        
        .weight-unit {
            font-size: 24px;
            color: #3498db;
            font-weight: 600;
        }
        
        .weight-conversion {
            font-size: 16px;
            color: #7f8c8d;
            margin-top: 10px;
        }
        
        /* Custom Slider Styling */
        .slider-container {
            margin: 30px 0;
            padding: 0 10px;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(to right, #2ecc71, #f39c12, #e74c3c);
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #2c3e50;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #2c3e50;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .weight-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #95a5a6;
        }
        
        /* Value Input Section */
        .value-input-container {
            margin: 20px 0;
        }
        
        .currency-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .currency-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
        }
        
        .currency-btn.selected {
            border-color: #3498db;
            background: #e3f2fd;
            color: #3498db;
        }
        
        .value-input-group {
            position: relative;
        }
        
        .value-input {
            width: 100%;
            padding: 20px 20px 20px 120px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 24px;
            font-weight: 700;
            text-align: right;
            background: white;
            transition: all 0.3s;
            direction: ltr;
        }
        
        .value-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .currency-symbol {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            font-weight: 700;
            color: #3498db;
            background: #e3f2fd;
            padding: 5px 15px;
            border-radius: 8px;
        }
        
        .value-hint {
            font-size: 14px;
            color: #95a5a6;
            margin-top: 10px;
            text-align: center;
        }
        
        /* Summary Section */
        .summary-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-color: #2196f3;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px dashed #90caf9;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            font-size: 16px;
            color: #1565c0;
            font-weight: 600;
        }
        
        .summary-value {
            font-size: 18px;
            color: #2c3e50;
            font-weight: 700;
        }
        
        /* Buttons */
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(46, 204, 113, 0.3);
        }
        
        .submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .cancel-btn {
            background: #f5f5f5;
            color: #666;
            border: 2px solid #e0e0e0;
        }
        
        .cancel-btn:hover {
            background: #e0e0e0;
        }
        
        /* Loading and Messages */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        .error-message {
            display: none;
            text-align: center;
            padding: 15px;
            background: #ffebee;
            border-radius: 10px;
            margin: 20px 0;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .success-message {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 80px;
            color: #2ecc71;
            margin-bottom: 20px;
        }
        
        /* Test Mode Notice */
        .test-notice {
            text-align: center;
            padding: 10px;
            background: #fff3e0;
            border-radius: 10px;
            margin: 20px 0;
            color: #ef6c00;
            font-size: 14px;
            border: 1px solid #ffcc80;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo"><i class="fas fa-box-open"></i></div>
            <h1>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­Ù…ÙˆÙ„Ù‡</h1>
            <p class="subtitle">Ù„Ø·ÙØ§ Ù†ÙˆØ¹ Ú©Ø§Ù„Ø§ØŒ ÙˆØ²Ù† Ùˆ Ø§Ø±Ø²Ø´ ØªØ®Ù…ÛŒÙ†ÛŒ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯</p>
        </div>
        
        <!-- Test Mode Notice -->
        <div class="test-notice" id="testNotice" style="display: none;">
            <strong>âš ï¸ Ø­Ø§Ù„Øª ØªØ³Øª:</strong> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø®Ø§Ø±Ø¬ Ø§Ø² ØªÙ„Ú¯Ø±Ø§Ù…. Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
        </div>
        
        <!-- Error Message -->
        <div class="error-message" id="errorMessage">
            <i class="fas fa-exclamation-triangle"></i>
            <p id="errorText">Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.</p>
        </div>
        
        <!-- Section 1: Cargo Type -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-tag"></i>
                <span>1. Ù†ÙˆØ¹ Ú©Ø§Ù„Ø§</span>
            </div>
            <p class="text-muted mb-3" style="text-align: center; font-size: 14px;">Ù„Ø·ÙØ§ Ù†ÙˆØ¹ Ú©Ø§Ù„Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</p>
            
            <div class="cargo-grid">
                <!-- Cargo Type 1: Valuable Metals and Jewel -->
                <div class="cargo-card cargo-1" data-type="valuable_metals" onclick="selectCargoType(1)">
                    <div class="cargo-icon"><i class="fas fa-gem"></i></div>
                    <div class="cargo-name">ÙÙ„Ø²Ø§Øª Ùˆ Ø¬ÙˆØ§Ù‡Ø±Ø§Øª Ú¯Ø±Ø§Ù†Ø¨Ù‡Ø§</div>
                    <div class="cargo-desc">Ø·Ù„Ø§ØŒ Ù†Ù‚Ø±Ù‡ØŒ Ø¬ÙˆØ§Ù‡Ø±Ø§ØªØŒ Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù„ÙˆÚ©Ø³</div>
                </div>
                
                <!-- Cargo Type 2: Fragile Items -->
                <div class="cargo-card cargo-2" data-type="fragile_items" onclick="selectCargoType(2)">
                    <div class="cargo-icon"><i class="fas fa-wine-glass-alt"></i></div>
                    <div class="cargo-name">Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ Ø´Ú©Ù†Ù†Ø¯Ù‡</div>
                    <div class="cargo-desc">Ø´ÛŒØ´Ù‡ØŒ Ú†ÛŒÙ†ÛŒØŒ ÙˆØ³Ø§ÛŒÙ„ Ø§Ù„Ú©ØªØ±ÙˆÙ†ÛŒÚ©ÛŒ Ø¸Ø±ÛŒÙ</div>
                </div>
                
                <!-- Cargo Type 3: Snacks and Food -->
                <div class="cargo-card cargo-3" data-type="snacks_food" onclick="selectCargoType(3)">
                    <div class="cargo-icon"><i class="fas fa-utensils"></i></div>
                    <div class="cargo-name">Ø®ÙˆØ±Ø§Ú©ÛŒ Ùˆ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ</div>
                    <div class="cargo-desc">Ø®Ø´Ú©Ø¨Ø§Ø±ØŒ Ø´Ú©Ù„Ø§ØªØŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</div>
                </div>
                
                <!-- Cargo Type 4: Clothes and Accessories -->
                <div class="cargo-card cargo-4" data-type="clothes_accessories" onclick="selectCargoType(4)">
                    <div class="cargo-icon"><i class="fas fa-tshirt"></i></div>
                    <div class="cargo-name">Ù¾ÙˆØ´Ø§Ú© Ùˆ Ø§Ú©Ø³Ø³ÙˆØ±ÛŒ</div>
                    <div class="cargo-desc">Ù„Ø¨Ø§Ø³ØŒ Ú©ÙØ´ØŒ Ú©ÛŒÙØŒ Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ</div>
                </div>
                
                <!-- Cargo Type 5: Health and Beauty Products -->
                <div class="cargo-card cargo-5" data-type="health_beauty" onclick="selectCargoType(5)">
                    <div class="cargo-icon"><i class="fas fa-pump-soap"></i></div>
                    <div class="cargo-name">Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³Ù„Ø§Ù…Øª Ùˆ Ø²ÛŒØ¨Ø§ÛŒÛŒ</div>
                    <div class="cargo-desc">Ù„ÙˆØ§Ø²Ù… Ø¢Ø±Ø§ÛŒØ´ÛŒØŒ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒØŒ Ø¯Ø§Ø±Ùˆ</div>
                </div>
                
                <!-- Cargo Type 6: Valuable Documents -->
                <div class="cargo-card cargo-6" data-type="valuable_documents" onclick="selectCargoType(6)">
                    <div class="cargo-icon"><i class="fas fa-file-contract"></i></div>
                    <div class="cargo-name">Ø§Ø³Ù†Ø§Ø¯ Ùˆ Ù…Ø¯Ø§Ø±Ú© Ø¨Ø§Ø§Ø±Ø²Ø´</div>
                    <div class="cargo-desc">Ù¾Ø§Ø³Ù¾ÙˆØ±ØªØŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§ØŒ Ø§Ø³Ù†Ø§Ø¯ Ù…Ù‡Ù…</div>
                </div>
            </div>
            
            <div id="cargoTypeInfo" style="display: none; text-align: center; padding: 15px; background: #e8f5e9; border-radius: 10px; margin-top: 15px;" class="fade-in">
                <strong>Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡:</strong> <span id="selectedCargoTypeText">Ù‡ÛŒÚ†</span>
            </div>
        </div>
        
        <!-- Section 2: Weight -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-weight-hanging"></i>
                <span>2. ÙˆØ²Ù† Ù…Ø­Ù…ÙˆÙ„Ù‡</span>
            </div>
            
            <div class="weight-display">
                <div class="weight-value" id="weightValue">0.1</div>
                <div class="weight-unit" id="weightUnit">Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</div>
                <div class="weight-conversion" id="weightConversion">(100 Ú¯Ø±Ù…)</div>
            </div>
            
            <div class="slider-container">
                <div class="slider-labels">
                    <span>100 Ú¯Ø±Ù…</span>
                    <span>15 Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</span>
                    <span>30 Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</span>
                </div>
                <input type="range" min="0.1" max="30" step="0.1" value="0.1" class="slider" id="weightSlider">
                <div class="weight-markers">
                    <span>Ø³Ø¨Ú©</span>
                    <span>Ù…ØªÙˆØ³Ø·</span>
                    <span>Ø³Ù†Ú¯ÛŒÙ†</span>
                </div>
            </div>
            
            <p class="text-muted" style="text-align: center; font-size: 14px; margin-top: 10px;">
                Ø­Ø¯Ø§Ú©Ø«Ø± ÙˆØ²Ù† Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„: 30 Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…
            </p>
        </div>
        
        <!-- Section 3: Estimated Value -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-dollar-sign"></i>
                <span>3. Ø§Ø±Ø²Ø´ ØªØ®Ù…ÛŒÙ†ÛŒ Ù…Ø­Ù…ÙˆÙ„Ù‡</span>
            </div>
            
            <div class="value-input-container">
                <div class="currency-selector">
                    <button class="currency-btn selected" data-currency="IRR" onclick="selectCurrency('IRR')">
                        <i class="fas fa-money-bill-wave"></i> Ø±ÛŒØ§Ù„
                    </button>
                    <button class="currency-btn" data-currency="USD" onclick="selectCurrency('USD')">
                        <i class="fas fa-dollar-sign"></i> Ø¯Ù„Ø§Ø±
                    </button>
                    <button class="currency-btn" data-currency="EUR" onclick="selectCurrency('EUR')">
                        <i class="fas fa-euro-sign"></i> ÛŒÙˆØ±Ùˆ
                    </button>
                </div>
                
                <div class="value-input-group">
                    <input type="number" id="estimatedValue" class="value-input" placeholder="0" min="0" step="1000">
                    <div class="currency-symbol" id="currencySymbol">Ø±ÛŒØ§Ù„</div>
                </div>
                
                <p class="value-hint">
                    Ù„Ø·ÙØ§ Ø§Ø±Ø²Ø´ ÙˆØ§Ù‚Ø¹ÛŒ Ú©Ø§Ù„Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ø¨ÛŒÙ…Ù‡ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª.
                </p>
            </div>
        </div>
        
        <!-- Summary Section -->
        <div class="section summary-section">
            <div class="section-title">
                <i class="fas fa-clipboard-list"></i>
                <span>Ø®Ù„Ø§ØµÙ‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</span>
            </div>
            
            <div class="summary-item">
                <div class="summary-label">Ù†ÙˆØ¹ Ú©Ø§Ù„Ø§:</div>
                <div class="summary-value" id="summaryCargoType">Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡</div>
            </div>
            
            <div class="summary-item">
                <div class="summary-label">ÙˆØ²Ù†:</div>
                <div class="summary-value" id="summaryWeight">0 Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</div>
            </div>
            
            <div class="summary-item">
                <div class="summary-label">Ø§Ø±Ø²Ø´ ØªØ®Ù…ÛŒÙ†ÛŒ:</div>
                <div class="summary-value" id="summaryValue">0 Ø±ÛŒØ§Ù„</div>
            </div>
            
            <div class="summary-item" style="border-top: 2px solid #2196f3; padding-top: 20px; margin-top: 10px;">
                <div class="summary-label" style="font-size: 18px; color: #0d47a1;">ÙˆØ¶Ø¹ÛŒØª:</div>
                <div class="summary-value" id="summaryStatus" style="font-size: 18px; color: #e74c3c;">Ù†Ø§Ù‚Øµ</div>
            </div>
        </div>
        
        <!-- Buttons -->
        <div class="buttons">
            <button class="cancel-btn" onclick="cancelProcess()">
                <i class="fas fa-times"></i> Ù„ØºÙˆ
            </button>
            <button class="submit-btn" id="submitBtn" onclick="submitCargoInfo()" disabled>
                <i class="fas fa-check"></i> Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª
            </button>
        </div>
        
        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</p>
        </div>
        
        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <div class="success-icon"><i class="fas fa-check-circle"></i></div>
            <h2>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!</h2>
            <p>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­Ù…ÙˆÙ„Ù‡ Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ø«Ø¨Øª Ø´Ø¯.</p>
            <p style="margin-top: 20px; color: #7f8c8d; font-size: 14px;">Ø§ÛŒÙ† Ù¾Ù†Ø¬Ø±Ù‡ Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø³ØªÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯...</p>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global variables
        let tg = null;
        let isTelegramWebApp = false;
        
        // CONFIGURATION - SET YOUR WEBHOOK URLS HERE
        const WEBHOOK_URL = 'https://aistudio.didbi.com/webhook/form/cargo_selection'; // â† Change this!
        const N8N_WEBHOOK_URL = 'https://aistudio.didbi.com/webhook/form/cargo_selection'; // â† Optional direct n8n
        
        // Store cargo data
        let cargoData = {
            cargo_type: null,
            cargo_type_name: null,
            weight_kg: 0.1,
            weight_display: "100 Ú¯Ø±Ù…",
            estimated_value: 0,
            currency: "IRR",
            currency_symbol: "Ø±ÛŒØ§Ù„",
            timestamp: null,
            status: "incomplete"
        };
        
        // Cargo type definitions
        const cargoTypes = {
            1: { 
                id: "valuable_metals", 
                name: "ÙÙ„Ø²Ø§Øª Ùˆ Ø¬ÙˆØ§Ù‡Ø±Ø§Øª Ú¯Ø±Ø§Ù†Ø¨Ù‡Ø§",
                description: "Ø·Ù„Ø§ØŒ Ù†Ù‚Ø±Ù‡ØŒ Ø¬ÙˆØ§Ù‡Ø±Ø§ØªØŒ Ø³Ø§Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù„ÙˆÚ©Ø³",
                icon: "fas fa-gem",
                risk_level: "high"
            },
            2: { 
                id: "fragile_items", 
                name: "Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ Ø´Ú©Ù†Ù†Ø¯Ù‡",
                description: "Ø´ÛŒØ´Ù‡ØŒ Ú†ÛŒÙ†ÛŒØŒ ÙˆØ³Ø§ÛŒÙ„ Ø§Ù„Ú©ØªØ±ÙˆÙ†ÛŒÚ©ÛŒ Ø¸Ø±ÛŒÙ",
                icon: "fas fa-wine-glass-alt",
                risk_level: "high"
            },
            3: { 
                id: "snacks_food", 
                name: "Ø®ÙˆØ±Ø§Ú©ÛŒ Ùˆ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ",
                description: "Ø®Ø´Ú©Ø¨Ø§Ø±ØŒ Ø´Ú©Ù„Ø§ØªØŒ Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",
                icon: "fas fa-utensils",
                risk_level: "medium"
            },
            4: { 
                id: "clothes_accessories", 
                name: "Ù¾ÙˆØ´Ø§Ú© Ùˆ Ø§Ú©Ø³Ø³ÙˆØ±ÛŒ",
                description: "Ù„Ø¨Ø§Ø³ØŒ Ú©ÙØ´ØŒ Ú©ÛŒÙØŒ Ù„ÙˆØ§Ø²Ù… Ø¬Ø§Ù†Ø¨ÛŒ",
                icon: "fas fa-tshirt",
                risk_level: "low"
            },
            5: { 
                id: "health_beauty", 
                name: "Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³Ù„Ø§Ù…Øª Ùˆ Ø²ÛŒØ¨Ø§ÛŒÛŒ",
                description: "Ù„ÙˆØ§Ø²Ù… Ø¢Ø±Ø§ÛŒØ´ÛŒØŒ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒØŒ Ø¯Ø§Ø±Ùˆ",
                icon: "fas fa-pump-soap",
                risk_level: "medium"
            },
            6: { 
                id: "valuable_documents", 
                name: "Ø§Ø³Ù†Ø§Ø¯ Ùˆ Ù…Ø¯Ø§Ø±Ú© Ø¨Ø§Ø§Ø±Ø²Ø´",
                description: "Ù¾Ø§Ø³Ù¾ÙˆØ±ØªØŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯Ù‡Ø§ØŒ Ø§Ø³Ù†Ø§Ø¯ Ù…Ù‡Ù…",
                icon: "fas fa-file-contract",
                risk_level: "high"
            }
        };
        
        // Currency information
        const currencies = {
            IRR: { symbol: "Ø±ÛŒØ§Ù„", name: "Ø±ÛŒØ§Ù„ Ø§ÛŒØ±Ø§Ù†", code: "IRR" },
            USD: { symbol: "$", name: "Ø¯Ù„Ø§Ø± Ø¢Ù…Ø±ÛŒÚ©Ø§", code: "USD" },
            EUR: { symbol: "â‚¬", name: "ÛŒÙˆØ±Ùˆ", code: "EUR" }
        };
        
        // Initialize Telegram Web App
        function initTelegramWebApp() {
            console.log('Initializing Telegram Web App...');
            
            if (window.Telegram && window.Telegram.WebApp) {
                try {
                    tg = window.Telegram.WebApp;
                    isTelegramWebApp = true;
                    
                    console.log('Telegram Web App detected');
                    console.log('Platform:', tg.platform);
                    
                    // Initialize Telegram Web App
                    tg.ready();
                    tg.expand();
                    tg.MainButton.hide();
                    
                    // Set theme params if needed
                    if (tg.colorScheme === 'dark') {
                        document.body.style.background = '#1a1a1a';
                        document.querySelector('.container').style.background = '#2d2d2d';
                        document.querySelector('.container').style.color = '#ffffff';
                    }
                    
                    return true;
                    
                } catch (error) {
                    console.error('Error initializing Telegram Web App:', error);
                    showError('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ ØªÙ„Ú¯Ø±Ø§Ù…');
                    return false;
                }
            } else {
                console.warn('Telegram Web App SDK not found. Running in test mode.');
                document.getElementById('testNotice').style.display = 'block';
                return false;
            }
        }
        
        // Show error message
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('errorMessage').style.display = 'none';
            }, 5000);
        }
        
        // Format weight display
        function formatWeight(kg) {
            if (kg < 1) {
                // Convert to grams
                const grams = Math.round(kg * 1000);
                return {
                    display: grams,
                    unit: "Ú¯Ø±Ù…",
                    conversion: `(${kg} Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…)`,
                    fullText: `${grams} Ú¯Ø±Ù…`
                };
            } else {
                // Show in kg with 1 decimal if needed
                const displayKg = kg % 1 === 0 ? kg : kg.toFixed(1);
                return {
                    display: displayKg,
                    unit: "Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…",
                    conversion: `(${Math.round(kg * 1000)} Ú¯Ø±Ù…)`,
                    fullText: `${displayKg} Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…`
                };
            }
        }
        
        // Format currency value
        function formatCurrency(value, currency) {
            const currencyInfo = currencies[currency];
            if (!currencyInfo) return { formatted: "0", symbol: "" };
            
            let formattedValue;
            if (currency === 'IRR') {
                // Format Iranian Rials with commas
                formattedValue = value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            } else {
                // Format USD/EUR with 2 decimal places
                formattedValue = parseFloat(value).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            
            return {
                formatted: formattedValue,
                symbol: currencyInfo.symbol,
                fullText: `${formattedValue} ${currencyInfo.symbol}`
            };
        }
        
        // Update weight display
        function updateWeightDisplay() {
            const weight = parseFloat(document.getElementById('weightSlider').value);
            const formatted = formatWeight(weight);
            
            document.getElementById('weightValue').textContent = formatted.display;
            document.getElementById('weightUnit').textContent = formatted.unit;
            document.getElementById('weightConversion').textContent = formatted.conversion;
            
            // Update cargo data
            cargoData.weight_kg = weight;
            cargoData.weight_display = formatted.fullText;
            
            updateSummary();
        }
        
        // Select cargo type
        function selectCargoType(typeId) {
            // Remove selected class from all cards
            document.querySelectorAll('.cargo-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to clicked card
            const selectedCard = document.querySelector(`.cargo-card[data-type="${cargoTypes[typeId].id}"]`);
            selectedCard.classList.add('selected');
            
            // Show selection info
            document.getElementById('cargoTypeInfo').style.display = 'block';
            document.getElementById('selectedCargoTypeText').textContent = cargoTypes[typeId].name;
            
            // Update cargo data
            cargoData.cargo_type = cargoTypes[typeId].id;
            cargoData.cargo_type_name = cargoTypes[typeId].name;
            
            updateSummary();
        }
        
        // Select currency
        function selectCurrency(currencyCode) {
            // Remove selected class from all buttons
            document.querySelectorAll('.currency-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selected class to clicked button
            document.querySelector(`.currency-btn[data-currency="${currencyCode}"]`).classList.add('selected');
            
            // Update currency symbol
            document.getElementById('currencySymbol').textContent = currencies[currencyCode].symbol;
            
            // Update cargo data
            cargoData.currency = currencyCode;
            cargoData.currency_symbol = currencies[currencyCode].symbol;
            
            updateSummary();
        }
        
        // Update value input
        function updateValueInput() {
            const value = document.getElementById('estimatedValue').value;
            cargoData.estimated_value = parseFloat(value) || 0;
            updateSummary();
        }
        
        // Update summary section
        function updateSummary() {
            // Update cargo type in summary
            document.getElementById('summaryCargoType').textContent = 
                cargoData.cargo_type_name || "Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡";
            
            // Update weight in summary
            document.getElementById('summaryWeight').textContent = 
                cargoData.weight_display || "0 Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…";
            
            // Update value in summary
            const formattedValue = formatCurrency(cargoData.estimated_value, cargoData.currency);
            document.getElementById('summaryValue').textContent = 
                formattedValue.fullText || "0 Ø±ÛŒØ§Ù„";
            
            // Update status
            const isComplete = cargoData.cargo_type && cargoData.estimated_value > 0;
            document.getElementById('summaryStatus').textContent = 
                isComplete ? "Ú©Ø§Ù…Ù„" : "Ù†Ø§Ù‚Øµ";
            document.getElementById('summaryStatus').style.color = 
                isComplete ? "#2ecc71" : "#e74c3c";
            
            // Enable/disable submit button
            document.getElementById('submitBtn').disabled = !isComplete;
            
            // Update cargo data status
            cargoData.status = isComplete ? "complete" : "incomplete";
            cargoData.timestamp = new Date().toISOString();
        }
        
        // Send data to webhook
        async function sendToWebhook(data) {
            try {
                console.log('Sending cargo data to webhook:', data);
                
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                console.log('Webhook response:', result);
                
                return result.success;
                
            } catch (error) {
                console.error('Error sending to webhook:', error);
                return false;
            }
        }
        
        // Send directly to n8n (optional)
        async function sendDirectlyToN8N(data) {
            try {
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                return response.ok;
                
            } catch (error) {
                console.error('Error sending to n8n:', error);
                return false;
            }
        }
        
        // Get user IP address
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }
        
        // Main submit function
        async function submitCargoInfo() {
            // Validate data
            if (!cargoData.cargo_type) {
                showError('Ù„Ø·ÙØ§ Ù†ÙˆØ¹ Ú©Ø§Ù„Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            if (cargoData.estimated_value <= 0) {
                showError('Ù„Ø·ÙØ§ Ø§Ø±Ø²Ø´ ØªØ®Ù…ÛŒÙ†ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.querySelector('.buttons').style.display = 'none';
            
            // Get Telegram user info if available
            let telegramUser = {};
            if (isTelegramWebApp && tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                telegramUser = {
                    telegram_id: tg.initDataUnsafe.user.id,
                    telegram_username: tg.initDataUnsafe.user.username,
                    telegram_first_name: tg.initDataUnsafe.user.first_name,
                    telegram_last_name: tg.initDataUnsafe.user.last_name,
                    telegram_language_code: tg.initDataUnsafe.user.language_code
                };
            }
            
            // Get selected cargo type details
            const selectedCargoType = Object.values(cargoTypes).find(
                type => type.id === cargoData.cargo_type
            );
            
            // Prepare data to send
            const data = {
                action: 'cargo_info_submitted',
                timestamp: new Date().toISOString(),
                cargo_info: {
                    type: {
                        id: cargoData.cargo_type,
                        name: cargoData.cargo_type_name,
                        description: selectedCargoType?.description || '',
                        risk_level: selectedCargoType?.risk_level || 'medium'
                    },
                    weight: {
                        kg: cargoData.weight_kg,
                        grams: Math.round(cargoData.weight_kg * 1000),
                        display: cargoData.weight_display
                    },
                    value: {
                        amount: cargoData.estimated_value,
                        currency: cargoData.currency,
                        currency_symbol: cargoData.currency_symbol,
                        formatted: formatCurrency(cargoData.estimated_value, cargoData.currency).fullText
                    },
                    insurance_required: selectedCargoType?.risk_level === 'high' && cargoData.estimated_value > 1000000
                },
                telegram_user: telegramUser,
                source: 'telegram_cargo_info_web_app',
                ip_address: await getUserIP(),
                metadata: {
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    user_agent: navigator.userAgent,
                    language: navigator.language,
                    screen_resolution: `${window.screen.width}x${window.screen.height}`
                }
            };
            
            console.log('Cargo data to send:', data);
            
            // Send data using multiple methods (with fallbacks)
            let success = false;
            
            // Method 1: Send to webhook.php
            if (WEBHOOK_URL && !WEBHOOK_URL.includes('your-domain.com')) {
                success = await sendToWebhook(data);
            }
            
            // Method 2: Try direct n8n webhook if webhook.php fails or not configured
            if (!success && N8N_WEBHOOK_URL && !N8N_WEBHOOK_URL.includes('your-n8n.com')) {
                success = await sendDirectlyToN8N(data);
            }
            
            // Method 3: Try Telegram sendData as fallback
            if (!success && isTelegramWebApp && tg && tg.sendData) {
                try {
                    tg.sendData(JSON.stringify(data));
                    success = true;
                    console.log('Data sent via Telegram sendData');
                } catch (error) {
                    console.error('Telegram sendData error:', error);
                }
            }
            
            // If all methods failed and we're not in Telegram, consider it success for testing
            if (!success && !isTelegramWebApp) {
                console.log('Test mode: Data logged to console');
                success = true; // For testing purposes
            }
            
            // Show success message
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                
                // Close after 3 seconds if in Telegram
                setTimeout(() => {
                    if (isTelegramWebApp && tg && tg.close) {
                        tg.close();
                    } else {
                        // Show manual close message for browser
                        document.getElementById('successMessage').innerHTML += 
                            '<p style="margin-top: 20px; color: #7f8c8d; font-size: 14px;">Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§ÛŒÙ† Ù¾Ù†Ø¬Ø±Ù‡ Ø±Ø§ Ø¨Ø¨Ù†Ø¯ÛŒØ¯.</p>';
                    }
                }, 3000);
                
            }, 1500);
        }
        
        function cancelProcess() {
            if (isTelegramWebApp && tg && tg.close) {
                tg.close();
            } else {
                if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                    window.location.reload();
                }
            }
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Telegram Web App
            const telegramInitialized = initTelegramWebApp();
            
            // Setup weight slider
            const weightSlider = document.getElementById('weightSlider');
            weightSlider.addEventListener('input', updateWeightDisplay);
            
            // Setup value input
            const valueInput = document.getElementById('estimatedValue');
            valueInput.addEventListener('input', updateValueInput);
            
            // Set initial weight display
            updateWeightDisplay();
            
            // Set initial summary
            updateSummary();
            
            // Add test button if not in Telegram
            if (!telegramInitialized) {
                const testButton = document.createElement('button');
                testButton.innerHTML = 'ğŸ§ª ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ (Ø¨Ø¯ÙˆÙ† ØªÙ„Ú¯Ø±Ø§Ù…)';
                testButton.style.cssText = `
                    background: #ff9800;
                    color: white;
                    border: none;
                    padding: 12px;
                    border-radius: 10px;
                    margin-top: 15px;
                    width: 100%;
                    font-weight: bold;
                    cursor: pointer;
                `;
                testButton.onclick = function() {
                    console.log('Test mode activated');
                    
                    // Auto-fill some test data
                    selectCargoType(1);
                    weightSlider.value = 2.5;
                    updateWeightDisplay();
                    valueInput.value = "15000000";
                    updateValueInput();
                    
                    // Submit after a short delay
                    setTimeout(() => {
                        submitCargoInfo();
                    }, 500);
                };
                document.querySelector('.buttons').appendChild(testButton);
            }
            
            // Check if webhook URL is configured
            if (WEBHOOK_URL.includes('your-domain.com')) {
                showError('Ù„Ø·ÙØ§Ù‹ Ø¢Ø¯Ø±Ø³ ÙˆØ¨â€ŒÙ‡ÙˆÚ© Ø±Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ø¯ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
            }
        });
    </script>
</body>
</html>