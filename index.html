<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اطلاعات محموله | Carry to Me</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            direction: rtl;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 550px;
            overflow: hidden;
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: 700;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .section {
            margin: 25px 0;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: #f9f9f9;
        }
        
        .section-title {
            color: #444;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .section-title i {
            color: #3498db;
        }
        
        /* Cargo Type Selection - Cards Layout */
        .cargo-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 480px) {
            .cargo-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .cargo-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .cargo-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .cargo-card.selected {
            border-color: #2ecc71;
            background-color: #f0f9f0;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.2);
        }
        
        .cargo-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 10px;
        }
        
        /* Different colors for different cargo types */
        .cargo-1 .cargo-icon { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }
        .cargo-2 .cargo-icon { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
        .cargo-3 .cargo-icon { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); }
        .cargo-4 .cargo-icon { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
        .cargo-5 .cargo-icon { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); }
        .cargo-6 .cargo-icon { background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%); }
        
        .cargo-name {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .cargo-desc {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        /* Weight Slider Section */
        .weight-display {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border: 2px solid #dee2e6;
        }
        
        .weight-value {
            font-size: 48px;
            font-weight: 800;
            color: #2c3e50;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }
        
        .weight-unit {
            font-size: 24px;
            color: #3498db;
            font-weight: 600;
        }
        
        .weight-conversion {
            font-size: 16px;
            color: #7f8c8d;
            margin-top: 10px;
        }
        
        /* Custom Slider Styling */
        .slider-container {
            margin: 30px 0;
            padding: 0 10px;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(to right, #2ecc71, #f39c12, #e74c3c);
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #2c3e50;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #2c3e50;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .weight-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #95a5a6;
        }
        
        /* Estimated Value Section */
        .estimated-value-container {
            margin: 20px 0;
        }
        
        .reminder-box {
            background: #fff8e1;
            border: 2px solid #ffd54f;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .reminder-box i {
            color: #ff9800;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .reminder-title {
            font-size: 16px;
            font-weight: 700;
            color: #ef6c00;
            margin-bottom: 10px;
        }
        
        .reminder-text {
            font-size: 14px;
            color: #5d4037;
            line-height: 1.6;
        }
        
        .value-input-group {
            position: relative;
            margin-bottom: 15px;
        }
        
        .value-input {
            width: 100%;
            padding: 20px 20px 20px 120px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 700;
            text-align: right;
            background: white;
            transition: all 0.3s;
            direction: ltr;
        }
        
        .value-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .currency-symbol {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            font-weight: 700;
            color: #3498db;
            background: #e3f2fd;
            padding: 5px 15px;
            border-radius: 8px;
        }
        
        /* Insurance Checklist */
        .insurance-container {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border: 2px solid #dee2e6;
        }
        
        .insurance-options {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .insurance-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .insurance-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .insurance-option.selected {
            border-color: #3498db;
            background-color: #e3f2fd;
        }
        
        .insurance-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .insurance-yes .insurance-icon {
            color: #2ecc71;
        }
        
        .insurance-no .insurance-icon {
            color: #e74c3c;
        }
        
        .insurance-label {
            font-size: 16px;
            font-weight: 600;
        }
        
        /* Suggested Price Section */
        .suggested-price-container {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border: 2px solid #dee2e6;
        }
        
        .price-display {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 12px;
            border: 1px solid #bbdefb;
        }
        
        .minimum-price {
            font-size: 18px;
            color: #1565c0;
            margin-bottom: 10px;
        }
        
        .minimum-price-value {
            font-size: 32px;
            font-weight: 800;
            color: #2c3e50;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .commission-rate {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 10px;
        }
        
        .price-reminder {
            background: #f0f7ff;
            border: 1px solid #c5d9f1;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 14px;
            color: #2c3e50;
        }
        
        .price-input-container {
            margin-top: 25px;
        }
        
        .price-input-group {
            position: relative;
            margin-bottom: 20px;
        }
        
        .price-input {
            width: 100%;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            background: white;
            transition: all 0.3s;
            direction: ltr;
        }
        
        .price-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .price-input.valid {
            border-color: #2ecc71;
            background-color: #f0f9f0;
        }
        
        .price-input.invalid {
            border-color: #e74c3c;
            background-color: #ffebee;
        }
        
        .price-label {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            font-weight: 700;
            color: #3498db;
            background: #e3f2fd;
            padding: 5px 15px;
            border-radius: 8px;
        }
        
        .validation-message {
            text-align: center;
            font-size: 14px;
            margin-top: 10px;
            min-height: 20px;
        }
        
        .validation-success {
            color: #2ecc71;
        }
        
        .validation-warning {
            color: #e74c3c;
        }
        
        .validation-info {
            color: #3498db;
        }
        
        /* Summary Section */
        .summary-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-color: #2196f3;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px dashed #90caf9;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            font-size: 16px;
            color: #1565c0;
            font-weight: 600;
        }
        
        .summary-value {
            font-size: 18px;
            color: #2c3e50;
            font-weight: 700;
        }
        
        /* Buttons */
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(46, 204, 113, 0.3);
        }
        
        .submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .cancel-btn {
            background: #f5f5f5;
            color: #666;
            border: 2px solid #e0e0e0;
        }
        
        .cancel-btn:hover {
            background: #e0e0e0;
        }
        
        /* Loading and Messages */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        .error-message {
            display: none;
            text-align: center;
            padding: 15px;
            background: #ffebee;
            border-radius: 10px;
            margin: 20px 0;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .success-message {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 80px;
            color: #2ecc71;
            margin-bottom: 20px;
        }
        
        /* Test Mode Notice */
        .test-notice {
            text-align: center;
            padding: 10px;
            background: #fff3e0;
            border-radius: 10px;
            margin: 20px 0;
            color: #ef6c00;
            font-size: 14px;
            border: 1px solid #ffcc80;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo"><i class="fas fa-box-open"></i></div>
            <h1>اطلاعات محموله</h1>
            <p class="subtitle">لطفا نوع کالا، وزن و ارزش تقریبی را مشخص کنید</p>
        </div>
        
        <!-- Test Mode Notice -->
        <div class="test-notice" id="testNotice" style="display: none;">
            <strong>⚠️ حالت تست:</strong> در حال اجرا خارج از تلگرام. اطلاعات در کنسول نمایش داده می‌شود.
        </div>
        
        <!-- Error Message -->
        <div class="error-message" id="errorMessage">
            <i class="fas fa-exclamation-triangle"></i>
            <p id="errorText">خطا در ارسال اطلاعات. لطفاً دوباره تلاش کنید.</p>
        </div>
        
        <!-- Section 1: Cargo Type -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-tag"></i>
                <span>1. نوع کالا</span>
            </div>
            <p class="text-muted mb-3" style="text-align: center; font-size: 14px;">لطفا نوع کالای خود را انتخاب کنید</p>
            
            <div class="cargo-grid">
                <!-- Cargo Type 1: Valuable Metals and Jewel -->
                <div class="cargo-card cargo-1" data-type="valuable_metals" onclick="selectCargoType(1)">
                    <div class="cargo-icon"><i class="fas fa-gem"></i></div>
                    <div class="cargo-name">فلزات و جواهرات گرانبها</div>
                    <div class="cargo-desc">طلا، نقره، جواهرات، ساعت‌های لوکس</div>
                </div>
                
                <!-- Cargo Type 2: Fragile Items -->
                <div class="cargo-card cargo-2" data-type="fragile_items" onclick="selectCargoType(2)">
                    <div class="cargo-icon"><i class="fas fa-wine-glass-alt"></i></div>
                    <div class="cargo-name">کالاهای شکننده</div>
                    <div class="cargo-desc">شیشه، چینی، وسایل الکترونیکی ظریف</div>
                </div>
                
                <!-- Cargo Type 3: Snacks and Food -->
                <div class="cargo-card cargo-3" data-type="snacks_food" onclick="selectCargoType(3)">
                    <div class="cargo-icon"><i class="fas fa-utensils"></i></div>
                    <div class="cargo-name">خوراکی و مواد غذایی</div>
                    <div class="cargo-desc">خشکبار، شکلات، مواد غذایی بسته‌بندی</div>
                </div>
                
                <!-- Cargo Type 4: Clothes and Accessories -->
                <div class="cargo-card cargo-4" data-type="clothes_accessories" onclick="selectCargoType(4)">
                    <div class="cargo-icon"><i class="fas fa-tshirt"></i></div>
                    <div class="cargo-name">پوشاک و اکسسوری</div>
                    <div class="cargo-desc">لباس، کفش، کیف، لوازم جانبی</div>
                </div>
                
                <!-- Cargo Type 5: Health and Beauty Products -->
                <div class="cargo-card cargo-5" data-type="health_beauty" onclick="selectCargoType(5)">
                    <div class="cargo-icon"><i class="fas fa-pump-soap"></i></div>
                    <div class="cargo-name">محصولات سلامت و زیبایی</div>
                    <div class="cargo-desc">لوازم آرایشی، بهداشتی، دارو</div>
                </div>
                
                <!-- Cargo Type 6: Valuable Documents -->
                <div class="cargo-card cargo-6" data-type="valuable_documents" onclick="selectCargoType(6)">
                    <div class="cargo-icon"><i class="fas fa-file-contract"></i></div>
                    <div class="cargo-name">اسناد و مدارک باارزش</div>
                    <div class="cargo-desc">پاسپورت، قراردادها، اسناد مهم</div>
                </div>
            </div>
            
            <div id="cargoTypeInfo" style="display: none; text-align: center; padding: 15px; background: #e8f5e9; border-radius: 10px; margin-top: 15px;" class="fade-in">
                <strong>انتخاب شده:</strong> <span id="selectedCargoTypeText">هیچ</span>
            </div>
        </div>
        
        <!-- Section 2: Weight -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-weight-hanging"></i>
                <span>2. وزن محموله</span>
            </div>
            
            <div class="weight-display">
                <div class="weight-value" id="weightValue">0.1</div>
                <div class="weight-unit" id="weightUnit">کیلوگرم</div>
                <div class="weight-conversion" id="weightConversion">(100 گرم)</div>
            </div>
            
            <div class="slider-container">
                <div class="slider-labels">
                    <span>100 گرم</span>
                    <span>15 کیلوگرم</span>
                    <span>30 کیلوگرم</span>
                </div>
                <input type="range" min="0.1" max="30" step="0.1" value="0.1" class="slider" id="weightSlider">
                <div class="weight-markers">
                    <span>سبک</span>
                    <span>متوسط</span>
                    <span>سنگین</span>
                </div>
            </div>
            
            <p class="text-muted" style="text-align: center; font-size: 14px; margin-top: 10px;">
                حداکثر وزن قابل قبول: 30 کیلوگرم
            </p>
        </div>
        
        <!-- Section 3: Estimated Value -->
        <div class="section" id="estimatedValueSection" style="display: none;">
            <div class="section-title">
                <i class="fas fa-dollar-sign"></i>
                <span>3. ارزش تقریبی کالا</span>
            </div>
            
            <div class="estimated-value-container">
                <div class="reminder-box">
                    <i class="fas fa-exclamation-circle"></i>
                    <div class="reminder-title">توجه مهم</div>
                    <div class="reminder-text">
                        <strong>ارزش‌گذاری صحیح کالا شما:</strong><br>
                        ۱. بیمه امن‌تری برای کالایتان فراهم می‌کند<br>
                        ۲. شانس پذیرش توسط مسافران را افزایش می‌دهد<br>
                        ۳. نشان‌دهنده درک شما از ارزش واقعی کالاست<br><br>
                        <em>لطفاً ارزش واقعی کالای خود را به دقت وارد کنید</em>
                    </div>
                </div>
                
                <div class="value-input-group">
                    <input type="number" id="estimatedValue" class="value-input" placeholder="0" min="0" step="1000">
                    <div class="currency-symbol">ریال</div>
                </div>
            </div>
        </div>
        
        <!-- Section 4: Insurance -->
        <div class="section" id="insuranceSection" style="display: none;">
            <div class="section-title">
                <i class="fas fa-shield-alt"></i>
                <span>4. بیمه کالا</span>
            </div>
            
            <div class="insurance-container">
                <p style="text-align: center; margin-bottom: 20px; color: #2c3e50;">
                    آیا کالای شما نیاز به بیمه دارد؟
                </p>
                
                <div class="insurance-options">
                    <div class="insurance-option insurance-yes" onclick="selectInsurance('yes')">
                        <div class="insurance-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="insurance-label">بله، نیاز به بیمه دارد</div>
                    </div>
                    
                    <div class="insurance-option insurance-no" onclick="selectInsurance('no')">
                        <div class="insurance-icon"><i class="fas fa-times-circle"></i></div>
                        <div class="insurance-label">خیر، نیاز به بیمه ندارد</div>
                    </div>
                </div>
                
                <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #7f8c8d;">
                    بیمه برای کالاهای باارزش و شکننده توصیه می‌شود
                </p>
            </div>
        </div>
        
        <!-- Section 5: Suggested Price -->
        <div class="section" id="suggestedPriceSection" style="display: none;">
            <div class="section-title">
                <i class="fas fa-handshake"></i>
                <span>5. قیمت پیشنهادی ارسال</span>
            </div>
            
            <div class="suggested-price-container">
                <div class="price-display">
                    <div class="minimum-price">کمترین قیمت انتقال (کف قیمت)</div>
                    <div class="minimum-price-value" id="minimumPriceValue">0 ریال</div>
                    <div class="commission-rate" id="commissionRateInfo">نرخ کمیسیون: 0%</div>
                </div>
                
                <div class="price-reminder">
                    <i class="fas fa-info-circle" style="color: #3498db; margin-left: 5px;"></i>
                    برای بالابردن احتمال پذیرش توسط مسافران، می‌توانید قیمت را افزایش دهید
                </div>
                
                <div class="price-input-container">
                    <div class="price-input-group">
                        <input type="number" id="suggestedPrice" class="price-input" placeholder="قیمت پیشنهادی خود را وارد کنید" min="0" step="1000">
                        <div class="price-label">ریال</div>
                    </div>
                    
                    <div class="validation-message" id="validationMessage">
                        <span id="validationText">قیمت پیشنهادی خود را وارد کنید</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Summary Section -->
        <div class="section summary-section">
            <div class="section-title">
                <i class="fas fa-clipboard-list"></i>
                <span>خلاصه اطلاعات</span>
            </div>
            
            <div class="summary-item">
                <div class="summary-label">نوع کالا:</div>
                <div class="summary-value" id="summaryCargoType">انتخاب نشده</div>
            </div>
            
            <div class="summary-item">
                <div class="summary-label">وزن:</div>
                <div class="summary-value" id="summaryWeight">0 کیلوگرم</div>
            </div>
            
            <div class="summary-item">
                <div class="summary-label">ارزش تقریبی:</div>
                <div class="summary-value" id="summaryEstimatedValue">وارد نشده</div>
            </div>
            
            <div class="summary-item">
                <div class="summary-label">بیمه:</div>
                <div class="summary-value" id="summaryInsurance">انتخاب نشده</div>
            </div>
            
            <div class="summary-item">
                <div class="summary-label">کمیسیون:</div>
                <div class="summary-value" id="summaryCommission">0%</div>
            </div>
            
            <div class="summary-item">
                <div class="summary-label">قیمت پیشنهادی:</div>
                <div class="summary-value" id="summarySuggestedPrice">وارد نشده</div>
            </div>
            
            <div class="summary-item" style="border-top: 2px solid #2196f3; padding-top: 20px; margin-top: 10px;">
                <div class="summary-label" style="font-size: 18px; color: #0d47a1;">وضعیت:</div>
                <div class="summary-value" id="summaryStatus" style="font-size: 18px; color: #e74c3c;">ناقص</div>
            </div>
        </div>
        
        <!-- Buttons -->
        <div class="buttons">
            <button class="cancel-btn" onclick="cancelProcess()">
                <i class="fas fa-times"></i> لغو
            </button>
            <button class="submit-btn" id="submitBtn" onclick="submitCargoInfo()" disabled>
                <i class="fas fa-check"></i> ثبت اطلاعات
            </button>
        </div>
        
        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>در حال ارسال اطلاعات...</p>
        </div>
        
        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <div class="success-icon"><i class="fas fa-check-circle"></i></div>
            <h2>اطلاعات با موفقیت ثبت شد!</h2>
            <p>منتظر تأیید مسافر باشید.</p>
            <p style="margin-top: 20px; color: #7f8c8d; font-size: 14px;">این پنجره به طور خودکار بسته خواهد شد...</p>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global variables
        let tg = null;
        let isTelegramWebApp = false;
        
        // CONFIGURATION - SET YOUR WEBHOOK URLS HERE
        const WEBHOOK_URL = 'https://aistudio.didbi.com/webhook/form/cargo_selection';
        
        // Store cargo data
        let cargoData = {
            cargo_type: null,
            cargo_type_name: null,
            weight_kg: 0.1,
            weight_display: "100 گرم",
            estimated_value: 0,
            insurance_required: null,
            commission_rate: 0,
            minimum_price: 0,
            suggested_price: 0,
            currency: "IRR",
            timestamp: null,
            status: "incomplete"
        };
        
        // Cargo type definitions with commission rates (updated as requested)
        const cargoTypes = {
            1: { 
                id: "valuable_metals", 
                name: "فلزات و جواهرات گرانبها",
                description: "طلا، نقره، جواهرات، ساعت‌های لوکس",
                icon: "fas fa-gem",
                commission_rate: 2, // 2% as requested
                risk_level: "high"
            },
            2: { 
                id: "fragile_items", 
                name: "کالاهای شکننده",
                description: "شیشه، چینی، وسایل الکترونیکی ظریف",
                icon: "fas fa-wine-glass-alt",
                commission_rate: 6, // 6% as requested
                risk_level: "high"
            },
            3: { 
                id: "snacks_food", 
                name: "خوراکی و مواد غذایی",
                description: "خشکبار، شکلات، مواد غذایی بسته‌بندی",
                icon: "fas fa-utensils",
                commission_rate: 6, // 6% as requested
                risk_level: "low"
            },
            4: { 
                id: "clothes_accessories", 
                name: "پوشاک و اکسسوری",
                description: "لباس، کفش، کیف، لوازم جانبی",
                icon: "fas fa-tshirt",
                commission_rate: 5, // 5% as requested
                risk_level: "low"
            },
            5: { 
                id: "health_beauty", 
                name: "محصولات سلامت و زیبایی",
                description: "لوازم آرایشی، بهداشتی، دارو",
                icon: "fas fa-pump-soap",
                commission_rate: 4, // 4% as requested
                risk_level: "medium"
            },
            6: { 
                id: "valuable_documents", 
                name: "اسناد و مدارک باارزش",
                description: "پاسپورت، قراردادها، اسناد مهم",
                icon: "fas fa-file-contract",
                commission_rate: 5, // 5% as requested
                risk_level: "high"
            }
        };
        
        // Initialize Telegram Web App
        function initTelegramWebApp() {
            console.log('Initializing Telegram Web App...');
            
            if (window.Telegram && window.Telegram.WebApp) {
                try {
                    tg = window.Telegram.WebApp;
                    isTelegramWebApp = true;
                    
                    console.log('Telegram Web App detected');
                    console.log('Platform:', tg.platform);
                    
                    // Initialize Telegram Web App
                    tg.ready();
                    tg.expand();
                    tg.MainButton.hide();
                    
                    // Set theme params if needed
                    if (tg.colorScheme === 'dark') {
                        document.body.style.background = '#1a1a1a';
                        document.querySelector('.container').style.background = '#2d2d2d';
                        document.querySelector('.container').style.color = '#ffffff';
                    }
                    
                    return true;
                    
                } catch (error) {
                    console.error('Error initializing Telegram Web App:', error);
                    showError('خطا در ارتباط با تلگرام');
                    return false;
                }
            } else {
                console.warn('Telegram Web App SDK not found. Running in test mode.');
                document.getElementById('testNotice').style.display = 'block';
                return false;
            }
        }
        
        // Show error message
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('errorMessage').style.display = 'none';
            }, 5000);
        }
        
        // Format weight display
        function formatWeight(kg) {
            if (kg < 1) {
                // Convert to grams
                const grams = Math.round(kg * 1000);
                return {
                    display: grams,
                    unit: "گرم",
                    conversion: `(${kg} کیلوگرم)`,
                    fullText: `${grams} گرم`
                };
            } else {
                // Show in kg with 1 decimal if needed
                const displayKg = kg % 1 === 0 ? kg : kg.toFixed(1);
                return {
                    display: displayKg,
                    unit: "کیلوگرم",
                    conversion: `(${Math.round(kg * 1000)} گرم)`,
                    fullText: `${displayKg} کیلوگرم`
                };
            }
        }
        
        // Format currency value
        function formatCurrency(value) {
            if (!value) return "0 ریال";
            // Format Iranian Rials with commas
            return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " ریال";
        }
        
        // Update weight display
        function updateWeightDisplay() {
            const weight = parseFloat(document.getElementById('weightSlider').value);
            const formatted = formatWeight(weight);
            
            document.getElementById('weightValue').textContent = formatted.display;
            document.getElementById('weightUnit').textContent = formatted.unit;
            document.getElementById('weightConversion').textContent = formatted.conversion;
            
            // Update cargo data
            cargoData.weight_kg = weight;
            cargoData.weight_display = formatted.fullText;
            
            updateSummary();
        }
        
        // Select cargo type
        function selectCargoType(typeId) {
            // Remove selected class from all cards
            document.querySelectorAll('.cargo-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to clicked card
            const selectedCard = document.querySelector(`.cargo-card[data-type="${cargoTypes[typeId].id}"]`);
            selectedCard.classList.add('selected');
            
            // Show selection info
            document.getElementById('cargoTypeInfo').style.display = 'block';
            document.getElementById('selectedCargoTypeText').textContent = cargoTypes[typeId].name;
            
            // Show estimated value section
            document.getElementById('estimatedValueSection').style.display = 'block';
            
            // Update cargo data
            cargoData.cargo_type = cargoTypes[typeId].id;
            cargoData.cargo_type_name = cargoTypes[typeId].name;
            
            updateSummary();
        }
        
        // Update estimated value
        function updateEstimatedValue() {
            const estimatedValue = parseInt(document.getElementById('estimatedValue').value) || 0;
            cargoData.estimated_value = estimatedValue;
            
            // Show insurance section if value is entered
            if (estimatedValue > 0) {
                document.getElementById('insuranceSection').style.display = 'block';
            } else {
                document.getElementById('insuranceSection').style.display = 'none';
                document.getElementById('suggestedPriceSection').style.display = 'none';
            }
            
            updateMinimumPrice();
            updateSummary();
        }
        
        // Select insurance option
        function selectInsurance(option) {
            // Remove selected class from all options
            document.querySelectorAll('.insurance-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selected class to clicked option
            const selectedOption = document.querySelector(`.insurance-${option}`);
            selectedOption.classList.add('selected');
            
            // Update cargo data
            cargoData.insurance_required = option === 'yes';
            
            // Show suggested price section
            document.getElementById('suggestedPriceSection').style.display = 'block';
            
            updateMinimumPrice();
            updateSummary();
        }
        
        // Update minimum price calculation
        function updateMinimumPrice() {
            if (!cargoData.cargo_type || cargoData.estimated_value <= 0) return;
            
            const cargoType = Object.values(cargoTypes).find(type => type.id === cargoData.cargo_type);
            if (!cargoType) return;
            
            // Calculate minimum price based on estimated value and commission rate
            const commissionRate = cargoType.commission_rate;
            const minimumPrice = Math.round(cargoData.estimated_value * (commissionRate / 100));
            
            // Update display
            document.getElementById('minimumPriceValue').textContent = formatCurrency(minimumPrice);
            document.getElementById('commissionRateInfo').textContent = `نرخ کمیسیون: ${commissionRate}%`;
            
            // Store values
            cargoData.commission_rate = commissionRate;
            cargoData.minimum_price = minimumPrice;
            
            // Set suggested price input placeholder to minimum price
            document.getElementById('suggestedPrice').placeholder = `حداقل ${formatCurrency(minimumPrice)}`;
            
            // Validate current suggested price
            validateSuggestedPrice();
        }
        
        // Validate suggested price input
        function validateSuggestedPrice() {
            const priceInput = document.getElementById('suggestedPrice');
            const suggestedPrice = parseInt(priceInput.value) || 0;
            const validationText = document.getElementById('validationText');
            const validationMessage = document.getElementById('validationMessage');
            
            // Reset styling
            priceInput.classList.remove('valid', 'invalid');
            validationMessage.classList.remove('validation-success', 'validation-warning', 'validation-info');
            
            if (suggestedPrice === 0) {
                // No price entered
                validationText.textContent = 'قیمت پیشنهادی خود را وارد کنید';
                validationMessage.classList.add('validation-info');
                cargoData.suggested_price = 0;
                updateSubmitButton();
                return;
            }
            
            if (suggestedPrice < cargoData.minimum_price) {
                // Price is below minimum
                validationText.textContent = `قیمت پیشنهادی شما کمتر از کف قیمت (${formatCurrency(cargoData.minimum_price)}) است.`;
                priceInput.classList.add('invalid');
                validationMessage.classList.add('validation-warning');
                cargoData.suggested_price = suggestedPrice;
                updateSubmitButton();
                return;
            }
            
            if (suggestedPrice >= cargoData.minimum_price) {
                // Price is at or above minimum
                const percentageAbove = Math.round(((suggestedPrice - cargoData.minimum_price) / cargoData.minimum_price) * 100);
                
                if (percentageAbove === 0) {
                    validationText.textContent = 'قیمت پیشنهادی شما برابر با کف قیمت است.';
                } else if (percentageAbove <= 50) {
                    validationText.textContent = `قیمت پیشنهادی شما ${percentageAbove}% بالاتر از کف قیمت است. (مناسب)`;
                } else {
                    validationText.textContent = `قیمت پیشنهادی شما ${percentageAbove}% بالاتر از کف قیمت است. (عالی!)`;
                }
                
                priceInput.classList.add('valid');
                validationMessage.classList.add('validation-success');
                cargoData.suggested_price = suggestedPrice;
                updateSubmitButton();
                return;
            }
        }
        
        // Update submit button state
        function updateSubmitButton() {
            const isComplete = cargoData.cargo_type && 
                              cargoData.estimated_value > 0 && 
                              cargoData.insurance_required !== null && 
                              cargoData.suggested_price >= cargoData.minimum_price;
            
            document.getElementById('submitBtn').disabled = !isComplete;
            
            // Update cargo data status
            cargoData.status = isComplete ? "complete" : "incomplete";
            cargoData.timestamp = new Date().toISOString();
        }
        
        // Update summary section
        function updateSummary() {
            // Update cargo type in summary
            document.getElementById('summaryCargoType').textContent = 
                cargoData.cargo_type_name || "انتخاب نشده";
            
            // Update weight in summary
            document.getElementById('summaryWeight').textContent = 
                cargoData.weight_display || "0 کیلوگرم";
            
            // Update estimated value in summary
            document.getElementById('summaryEstimatedValue').textContent = 
                cargoData.estimated_value > 0 ? formatCurrency(cargoData.estimated_value) : "وارد نشده";
            
            // Update insurance in summary
            if (cargoData.insurance_required === true) {
                document.getElementById('summaryInsurance').textContent = "بله";
            } else if (cargoData.insurance_required === false) {
                document.getElementById('summaryInsurance').textContent = "خیر";
            } else {
                document.getElementById('summaryInsurance').textContent = "انتخاب نشده";
            }
            
            // Update commission in summary
            document.getElementById('summaryCommission').textContent = 
                cargoData.commission_rate > 0 ? `${cargoData.commission_rate}%` : "0%";
            
            // Update suggested price in summary
            document.getElementById('summarySuggestedPrice').textContent = 
                cargoData.suggested_price > 0 ? formatCurrency(cargoData.suggested_price) : "وارد نشده";
            
            // Update status
            const isComplete = cargoData.cargo_type && 
                              cargoData.estimated_value > 0 && 
                              cargoData.insurance_required !== null && 
                              cargoData.suggested_price >= cargoData.minimum_price;
            
            document.getElementById('summaryStatus').textContent = 
                isComplete ? "کامل" : "ناقص";
            document.getElementById('summaryStatus').style.color = 
                isComplete ? "#2ecc71" : "#e74c3c";
            
            updateSubmitButton();
        }
        
        // Send data to webhook
        async function sendToWebhook(data) {
            try {
                console.log('Sending cargo data to webhook:', data);
                
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                console.log('Webhook response:', result);
                
                return result.success;
                
            } catch (error) {
                console.error('Error sending to webhook:', error);
                return false;
            }
        }
        
        // Get user IP address
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }
        
        // Main submit function
        async function submitCargoInfo() {
            // Validate data
            if (!cargoData.cargo_type) {
                showError('لطفا نوع کالا را انتخاب کنید');
                return;
            }
            
            if (cargoData.estimated_value <= 0) {
                showError('لطفا ارزش تقریبی کالا را وارد کنید');
                return;
            }
            
            if (cargoData.insurance_required === null) {
                showError('لطفا وضعیت بیمه را انتخاب کنید');
                return;
            }
            
            if (cargoData.suggested_price < cargoData.minimum_price) {
                showError('قیمت پیشنهادی باید حداقل برابر با کف قیمت باشد');
                return;
            }
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.querySelector('.buttons').style.display = 'none';
            
            // Get Telegram user info if available
            let telegramUser = {};
            if (isTelegramWebApp && tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                telegramUser = {
                    telegram_id: tg.initDataUnsafe.user.id,
                    telegram_username: tg.initDataUnsafe.user.username,
                    telegram_first_name: tg.initDataUnsafe.user.first_name,
                    telegram_last_name: tg.initDataUnsafe.user.last_name,
                    telegram_language_code: tg.initDataUnsafe.user.language_code
                };
            }
            
            // Get selected cargo type details
            const selectedCargoType = Object.values(cargoTypes).find(
                type => type.id === cargoData.cargo_type
            );
            
            // Calculate percentage above minimum
            const percentageAboveMinimum = cargoData.minimum_price > 0 ? 
                Math.round(((cargoData.suggested_price - cargoData.minimum_price) / cargoData.minimum_price) * 100) : 0;
            
            // Prepare data to send
            const data = {
                action: 'cargo_info_submitted',
                timestamp: new Date().toISOString(),
                cargo_info: {
                    type: {
                        id: cargoData.cargo_type,
                        name: cargoData.cargo_type_name,
                        description: selectedCargoType?.description || '',
                        risk_level: selectedCargoType?.risk_level || 'medium'
                    },
                    weight: {
                        kg: cargoData.weight_kg,
                        grams: Math.round(cargoData.weight_kg * 1000),
                        display: cargoData.weight_display
                    },
                    value: {
                        estimated_value: cargoData.estimated_value,
                        currency: cargoData.currency,
                        formatted_value: formatCurrency(cargoData.estimated_value)
                    },
                    insurance: {
                        required: cargoData.insurance_required,
                        recommended: selectedCargoType?.risk_level === 'high' || cargoData.estimated_value > 10000000
                    },
                    pricing: {
                        commission_rate: cargoData.commission_rate,
                        minimum_price: cargoData.minimum_price,
                        suggested_price: cargoData.suggested_price,
                        currency: cargoData.currency,
                        formatted_minimum_price: formatCurrency(cargoData.minimum_price),
                        formatted_suggested_price: formatCurrency(cargoData.suggested_price),
                        percentage_above_minimum: percentageAboveMinimum,
                        is_above_minimum: cargoData.suggested_price >= cargoData.minimum_price
                    }
                },
                telegram_user: telegramUser,
                source: 'telegram_cargo_info_web_app',
                ip_address: await getUserIP(),
                metadata: {
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    user_agent: navigator.userAgent,
                    language: navigator.language,
                    screen_resolution: `${window.screen.width}x${window.screen.height}`
                }
            };
            
            console.log('Cargo data to send:', data);
            
            // Send data
            let success = false;
            
            if (WEBHOOK_URL && !WEBHOOK_URL.includes('your-domain.com')) {
                success = await sendToWebhook(data);
            }
            
            // Try Telegram sendData if webhook failed
            if (!success && isTelegramWebApp && tg && tg.sendData) {
                try {
                    tg.sendData(JSON.stringify(data));
                    success = true;
                    console.log('Data sent via Telegram sendData');
                } catch (error) {
                    console.error('Telegram sendData error:', error);
                }
            }
            
            // For testing
            if (!success && !isTelegramWebApp) {
                console.log('Test mode: Data logged to console');
                success = true;
            }
            
            // Show success message
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('successMessage').style.display = 'block';
                
                // Close after 3 seconds if in Telegram
                setTimeout(() => {
                    if (isTelegramWebApp && tg && tg.close) {
                        tg.close();
                    } else {
                        // Show manual close message for browser
                        document.getElementById('successMessage').innerHTML += 
                            '<p style="margin-top: 20px; color: #7f8c8d; font-size: 14px;">می‌توانید این پنجره را ببندید.</p>';
                    }
                }, 3000);
                
            }, 1500);
        }
        
        function cancelProcess() {
            if (isTelegramWebApp && tg && tg.close) {
                tg.close();
            } else {
                if (confirm('آیا از لغو عملیات اطمینان دارید؟')) {
                    window.location.reload();
                }
            }
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Telegram Web App
            const telegramInitialized = initTelegramWebApp();
            
            // Setup weight slider
            const weightSlider = document.getElementById('weightSlider');
            weightSlider.addEventListener('input', updateWeightDisplay);
            
            // Setup estimated value input
            const estimatedValueInput = document.getElementById('estimatedValue');
            estimatedValueInput.addEventListener('input', updateEstimatedValue);
            
            // Setup suggested price input
            const suggestedPriceInput = document.getElementById('suggestedPrice');
            suggestedPriceInput.addEventListener('input', validateSuggestedPrice);
            
            // Set initial weight display
            updateWeightDisplay();
            
            // Add test button if not in Telegram
            if (!telegramInitialized) {
                const testButton = document.createElement('button');
                testButton.innerHTML = '🧪 تست ارسال (بدون تلگرام)';
                testButton.style.cssText = `
                    background: #ff9800;
                    color: white;
                    border: none;
                    padding: 12px;
                    border-radius: 10px;
                    margin-top: 15px;
                    width: 100%;
                    font-weight: bold;
                    cursor: pointer;
                `;
                testButton.onclick = function() {
                    console.log('Test mode activated');
                    
                    // Auto-fill some test data
                    selectCargoType(1);
                    weightSlider.value = 2.5;
                    updateWeightDisplay();
                    estimatedValueInput.value = "50000000";
                    updateEstimatedValue();
                    selectInsurance('yes');
                    suggestedPriceInput.value = "1200000";
                    validateSuggestedPrice();
                    
                    // Submit after a short delay
                    setTimeout(() => {
                        submitCargoInfo();
                    }, 500);
                };
                document.querySelector('.buttons').appendChild(testButton);
            }
            
            // Check if webhook URL is configured
            if (WEBHOOK_URL.includes('your-domain.com')) {
                showError('لطفاً آدرس وب‌هوک را در تنظیمات کد وارد کنید.');
            }
        });
    </script>
</body>
</html>